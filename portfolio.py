<restored portfolio functions including local_data loading>